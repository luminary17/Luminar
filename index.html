<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luminary - Education Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-page: #FFF0DB;
            --bg-card: #FFFFFF;
            --text-main: #000000;
            --text-on-card: #000000;
            --accent: #D9B99B;
            --card-shadow: 0 4px 25px rgba(0,0,0,0.05);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-page);
            color: var(--text-main);
            min-height: 100vh;
            transition: 0.4s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 75px;
            background: #FFFFFF;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.03);
            z-index: 1000;
            padding: 0 20px;
        }

        .nav-content {
            width: 100%;
            max-width: 1000px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .top-nav .logo {
            color: #D9B99B;
            font-weight: 800;
            font-size: 24px;
            cursor: pointer;
            letter-spacing: -1px;
        }

        .admin-btn {
            background: #D9B99B;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            font-family: inherit;
            font-size: 12px;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }

        .admin-btn:hover {
            background: #c5a589;
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            gap: 10px;
        }

        .nav-item {
            background: none;
            border: none;
            font-family: inherit;
            font-size: 13px;
            font-weight: 700;
            color: #000000;
            cursor: pointer;
            opacity: 0.5;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px;
        }

        .nav-item.active {
            opacity: 1;
            border-bottom: 3px solid #D9B99B;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .container {
            width: 94%;
            max-width: 1000px;
            padding-top: 100px;
        }

        .view {
            display: none;
            width: 100%;
            animation: fadeIn 0.4s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Admin Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 25px;
            padding: 40px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 28px;
            font-weight: 800;
            color: #000000;
        }

        .close-modal {
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(0,0,0,0.05);
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            color: #000000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #FFF0DB;
            border-radius: 20px;
        }

        .admin-section h3 {
            margin: 0 0 15px 0;
            font-size: 20px;
            font-weight: 800;
            color: #000000;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 12px;
            font-family: inherit;
            font-size: 14px;
            background: white;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn-primary {
            background: #D9B99B;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-family: inherit;
            font-size: 14px;
            font-weight: 700;
            color: white;
            cursor: pointer;
            width: 100%;
            transition: 0.3s;
        }

        .btn-primary:hover {
            background: #c5a589;
            transform: translateY(-2px);
        }

        .item-list {
            margin-top: 20px;
        }

        .item-entry {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .book-admin-entry {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .book-admin-thumb {
            width: 60px;
            height: 90px;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .item-detail {
            font-size: 13px;
            color: #666;
        }

        .btn-delete {
            background: #ff4444;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-weight: 700;
            font-size: 12px;
            flex-shrink: 0;
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 700;
        }

        .reader-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-page);
            z-index: 2000;
            display: none;
            flex-direction: column;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .reader-header {
            height: 70px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            background: #FFFFFF;
            box-shadow: 0 2px 15px rgba(0,0,0,0.02);
        }

        .back-arrow {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: rgba(0,0,0,0.02);
            border-radius: 50%;
            margin-right: 15px;
        }

        .back-arrow svg {
            width: 24px;
            height: 24px;
            fill: #000000;
        }

        .reader-body {
            flex: 1;
            overflow-y: auto;
            padding: 40px 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .page-content {
            max-width: 600px;
            width: 100%;
            font-size: 19px;
            line-height: 1.8;
            color: var(--text-main);
            text-align: justify;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }

        .page-enter-right { transform: translateX(50px); opacity: 0; }
        .page-enter-left { transform: translateX(-50px); opacity: 0; }
        .page-active { transform: translateX(0); opacity: 1; }

        .touch-zone-left, .touch-zone-right {
            position: absolute;
            top: 0;
            width: 30%;
            height: 100%;
            z-index: 10;
            cursor: pointer;
        }

        .touch-zone-left { left: 0; }
        .touch-zone-right { right: 0; }

        .search-bar {
            background: #FFFFFF;
            border-radius: 18px;
            height: 55px;
            display: flex;
            align-items: center;
            padding: 0 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
            margin-bottom: 25px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .search-bar input {
            background: none;
            border: none;
            width: 100%;
            outline: none;
            font-size: 16px;
            color: #000000;
            font-family: inherit;
        }

        .search-bar input::placeholder {
            color: #666666;
        }

        .hero {
            width: 100%;
            height: 380px;
            border-radius: 30px;
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 40px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: 0.5s;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }

        .hero-text {
            position: relative;
            z-index: 2;
        }

        .hero-text h2 {
            margin: 0;
            font-size: 36px;
            font-weight: 800;
            color: white;
        }

        .hero-text p {
            color: white;
        }

        .label {
            font-size: 26px;
            font-weight: 800;
            margin: 35px 0 20px 5px;
            color: var(--text-main);
        }

        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }

        .book-card {
            aspect-ratio: 2/3;
            border-radius: 20px;
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .book-card:hover {
            transform: translateY(-8px);
        }

        .edu-section {
            display: none;
        }

        .edu-section.active {
            display: block;
        }

        .edu-card {
            background: #FFFFFF;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.02);
            margin-bottom: 20px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .edu-card:hover {
            transform: scale(1.02);
        }

        .edu-title {
            font-size: 24px;
            font-weight: 800;
            color: #000000;
        }

        .edu-icon {
            font-size: 30px;
            opacity: 0.5;
        }

        .vocab-list {
            display: grid;
            gap: 10px;
        }

        .vocab-item {
            background: #FFFFFF;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .v-word {
            font-weight: 800;
            font-size: 18px;
            color: #000000;
            margin-bottom: 4px;
        }

        .v-def {
            font-size: 14px;
            color: #333333;
            line-height: 1.4;
        }

        .back-btn-edu {
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 700;
            color: #000000;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .podcast-list {
            display: grid;
            gap: 20px;
        }

        .podcast-item {
            display: flex;
            background: #FFFFFF;
            border-radius: 25px;
            overflow: hidden;
            text-decoration: none;
            color: #000000;
            box-shadow: 0 2px 15px rgba(0,0,0,0.02);
            transition: 0.3s;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .podcast-thumb {
            width: 140px;
            height: 140px;
            background-size: cover;
            flex-shrink: 0;
        }

        .podcast-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .podcast-body h3 {
            margin: 0 0 8px 0;
            color: #000000;
        }

        .podcast-body span {
            color: #333333;
        }

        .home-footer {
            margin-top: 120px;
            margin-bottom: 40px;
            padding: 25px;
            text-align: center;
            background: #FFFFFF;
            border-radius: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.02);
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .home-footer .soc-title {
            font-weight: 800;
            font-size: 14px;
            color: #333333;
            margin-bottom: 15px;
        }

        .soc-row {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .soc-circle {
            width: 55px;
            height: 55px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            color: white;
            text-decoration: none;
        }

        .soc-circle svg {
            width: 28px;
            height: 28px;
            fill: currentColor;
        }

        .tg-c { background: #26A5E4; }
        .ig-c { background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fd5949 45%, #d6249f 60%, #285AEB 90%); }
        .yt-c { background: #FF0000; }

        .sub-card {
            background: #FFFFFF;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.02);
            margin-bottom: 20px;
            color: #000000;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .theme-btn {
            padding: 15px;
            border-radius: 15px;
            background: #FFFFFF;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            color: #000000;
            border: 1px solid rgba(0,0,0,0.05);
            transition: 0.3s;
        }

        .theme-btn.active {
            border-color: #D9B99B;
            border-width: 2.5px;
        }

        .color-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.1);
        }

        textarea {
            width: 100%;
            height: 150px;
            border: none;
            outline: none;
            background: transparent;
            font-family: inherit;
            font-size: 16px;
            color: #000000;
            resize: none;
        }

        textarea::placeholder {
            color: #666666;
        }

        .spacer {
            height: 100px;
        }
    </style>
</head>

<body>
    <nav class="top-nav">
        <div class="nav-content">
            <div class="logo-section">
                <div class="logo" onclick="goHome()">LUMINARY</div>
                <button class="admin-btn" onclick="openAdminPanel()">üîê Admin</button>
            </div>
            <div class="nav-links">
                <button class="nav-item active" id="n-h" onclick="switchTab('home')">
                    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" /></svg>
                    –î–æ–º
                </button>
                <button class="nav-item" id="n-e" onclick="switchTab('edu')">
                    <svg viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3z" /></svg>
                    –û–±—É—á–µ–Ω–∏–µ
                </button>
                <button class="nav-item" id="n-a" onclick="switchTab('audio')">
                    <svg viewBox="0 0 24 24"><path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z" /></svg>
                    –ê—É–¥–∏–æ
                </button>
                <button class="nav-item" id="n-u" onclick="switchTab('user')">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" /></svg>
                    –ü—Ä–æ—Ñ–∏–ª—å
                </button>
            </div>
        </div>
    </nav>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Admin Panel</div>
                <button class="close-modal" onclick="closeAdminPanel()">√ó</button>
            </div>

            <div id="password-section">
                <div class="admin-section">
                    <h3>üîê Enter Password</h3>
                    <div class="form-group">
                        <input type="password" id="admin-password" placeholder="Enter admin password" onkeypress="if(event.key==='Enter') checkPassword()">
                    </div>
                    <button class="btn-primary" onclick="checkPassword()">Login</button>
                    <p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">Default password: <strong>admin123</strong></p>
                </div>
            </div>

            <div id="admin-content" style="display: none;">
                <!-- Books Section -->
                <div class="admin-section">
                    <h3>üìö Add Book</h3>

                    <!-- Step 1: Book Info -->
                    <div id="book-step-1">
                        <div class="form-group">
                            <label>Book Title</label>
                            <input type="text" id="book-title" placeholder="e.g., The Great Gatsby">
                        </div>
                        <div class="form-group">
                            <label>Author</label>
                            <input type="text" id="book-author" placeholder="e.g., F. Scott Fitzgerald">
                        </div>
                        <div class="form-group">
                            <label>Cover Image URL</label>
                            <input type="text" id="book-cover" placeholder="https://example.com/cover.jpg">
                        </div>
                        <div class="form-group">
                            <label>Number of Chapters</label>
                            <input type="number" id="book-chapters" min="1" max="100" placeholder="e.g., 5">
                        </div>
                        <button class="btn-primary" onclick="setupChapters()">Next: Set Up Chapters ‚Üí</button>
                    </div>

                    <!-- Step 2: Chapter builder (hidden initially) -->
                    <div id="book-step-2" style="display:none;">
                        <div id="chapters-builder"></div>
                        <button class="btn-primary" onclick="addBook()" style="margin-top:15px;">‚úÖ Save Book</button>
                        <button style="width:100%;margin-top:10px;padding:12px;border-radius:12px;border:2px solid #D9B99B;background:none;font-family:inherit;font-weight:700;cursor:pointer;" onclick="resetBookForm()">‚Üê Start Over</button>
                    </div>

                    <div class="item-list" id="book-list-admin"></div>
                </div>

                <!-- SAT Vocabulary -->
                <div class="admin-section">
                    <h3>üìñ Add SAT Vocabulary</h3>
                    <div class="form-group">
                        <label>Word</label>
                        <input type="text" id="sat-word" placeholder="e.g., Benevolent">
                    </div>
                    <div class="form-group">
                        <label>Definition</label>
                        <textarea id="sat-def" placeholder="e.g., Well meaning and kindly"></textarea>
                    </div>
                    <button class="btn-primary" onclick="addSATWord()">Add SAT Word</button>
                    <div class="item-list" id="sat-word-list"></div>
                </div>

                <!-- IELTS Vocabulary -->
                <div class="admin-section">
                    <h3>üéì Add IELTS Vocabulary</h3>
                    <div class="form-group">
                        <label>Word</label>
                        <input type="text" id="ielts-word" placeholder="e.g., Coherent">
                    </div>
                    <div class="form-group">
                        <label>Definition</label>
                        <textarea id="ielts-def" placeholder="e.g., Logical and consistent"></textarea>
                    </div>
                    <button class="btn-primary" onclick="addIELTSWord()">Add IELTS Word</button>
                    <div class="item-list" id="ielts-word-list"></div>
                </div>

                <!-- Podcast/Audio -->
                <div class="admin-section">
                    <h3>üéß Add Podcast/Audio</h3>
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="podcast-title" placeholder="e.g., Romeo and Juliet">
                    </div>
                    <div class="form-group">
                        <label>YouTube URL</label>
                        <input type="text" id="podcast-url" placeholder="https://youtu.be/...">
                    </div>
                    <button class="btn-primary" onclick="addPodcast()">Add Podcast</button>
                    <div class="item-list" id="podcast-list-admin"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- HOME VIEW -->
        <div id="home-view" class="view active">
            <div class="search-bar">
                <input type="text" placeholder="–ü–æ–∏—Å–∫ –∫–Ω–∏–≥..." oninput="handleSearch(event)">
            </div>
            <div id="hero-banner" class="hero">
                <div class="hero-overlay"></div>
                <div class="hero-text">
                    <h2 id="hero-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                    <p>–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —á–∏—Ç–∞—Ç—å</p>
                </div>
            </div>
            <div class="label">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</div>
            <div id="book-grid" class="book-grid"></div>

            <div class="home-footer">
                <div class="soc-title">–ú–´ –í –°–û–¶–°–ï–¢–Ø–•</div>
                <div class="soc-row">
                    <a href="#" class="soc-circle tg-c"><svg viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" /></svg></a>
                    <a href="#" class="soc-circle ig-c"><svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" /></svg></a>
                    <a href="#" class="soc-circle yt-c"><svg viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" /></svg></a>
                </div>
            </div>
            <div class="spacer"></div>
        </div>

        <!-- EDUCATION VIEW -->
        <div id="edu-view" class="view">
            <div id="edu-main" class="edu-section active">
                <div class="label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                <div class="edu-card" onclick="openEduLevel('edu-sat')">
                    <div class="edu-title">SAT Prep</div>
                    <div class="edu-icon">üìö</div>
                </div>
                <div class="edu-card" onclick="openEduLevel('edu-ielts')">
                    <div class="edu-title">IELTS</div>
                    <div class="edu-icon">üéì</div>
                </div>
            </div>

            <div id="edu-sat" class="edu-section">
                <button class="back-btn-edu" onclick="openEduLevel('edu-main')">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="edu-card" onclick="openEduLevel('edu-vocab-sat')">
                    <div class="edu-title">Vocabulary</div>
                    <div class="edu-icon">üìñ</div>
                </div>
            </div>

            <div id="edu-ielts" class="edu-section">
                <button class="back-btn-edu" onclick="openEduLevel('edu-main')">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="edu-card" onclick="openEduLevel('edu-vocab-ielts')">
                    <div class="edu-title">Vocabulary</div>
                    <div class="edu-icon">üìñ</div>
                </div>
            </div>

            <div id="edu-vocab-sat" class="edu-section">
                <button class="back-btn-edu" onclick="openEduLevel('edu-sat')">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="label">SAT Words</div>
                <div class="vocab-list" id="vocab-list-sat"></div>
            </div>

            <div id="edu-vocab-ielts" class="edu-section">
                <button class="back-btn-edu" onclick="openEduLevel('edu-ielts')">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="label">IELTS Words</div>
                <div class="vocab-list" id="vocab-list-ielts"></div>
            </div>
            <div class="spacer"></div>
        </div>

        <!-- AUDIO VIEW -->
        <div id="audio-view" class="view">
            <div class="label">–ü–æ–¥–∫–∞—Å—Ç—ã</div>
            <div class="podcast-list" id="podcast-container"></div>
            <div class="spacer"></div>
        </div>

        <!-- USER VIEW -->
        <div id="user-view" class="view">
            <div class="label">–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</div>
            <div class="sub-card">
                <textarea id="notes-area" oninput="saveNotes()" placeholder="–ü–∏—à–∏ —Ç—É—Ç..."></textarea>
            </div>
            <div class="label">–¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</div>
            <div class="theme-grid" id="theme-grid"></div>
            <div class="spacer"></div>
        </div>
    </div>

    <!-- READER VIEW -->
    <div id="reader-view" class="reader-view">
        <div class="reader-header">
            <div class="back-arrow" onclick="closeBook()">
                <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>
            </div>
            <div id="reader-book-title" style="font-weight:800; color: #000000;"></div>
        </div>
        <div class="reader-body">
            <div class="touch-zone-left" onclick="animatePageChange(-1)"></div>
            <div class="touch-zone-right" onclick="animatePageChange(1)"></div>
            <div id="page-content" class="page-content page-active"></div>
        </div>
    </div>

    <script>
        const defaultBooks = [
            {
                t: "Steve Jobs",
                a: "Walter Isaacson",
                i: "https://is1-ssl.mzstatic.com/image/thumb/Publication114/v4/59/7e/03/597e0370-4d18-cc3d-09e3-3e7c6434e168/9781451648553.jpg/600x600w.png",
                pages: [
                    "–°—Ç–∏–≤ –î–∂–æ–±—Å –∏–∑–º–µ–Ω–∏–ª –º–∏—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π. –ï–≥–æ –≤–∏–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∞–ª–æ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏, –∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ã ‚Äî —É–º–Ω—ã–º–∏.",
                    "–û–Ω –æ—Å–Ω–æ–≤–∞–ª Apple –≤ –≥–∞—Ä–∞–∂–µ —Å–≤–æ–µ–≥–æ –æ—Ç—Ü–∞ –≤ 1976 –≥–æ–¥—É –≤–º–µ—Å—Ç–µ —Å–æ –°—Ç–∏–≤–æ–º –í–æ–∑–Ω—è–∫–æ–º.",
                    "–î–∂–æ–±—Å –±—ã–ª –∏–∑–≤–µ—Å—Ç–µ–Ω —Å–≤–æ–∏–º —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ–º –∫ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É, –¥–∞–∂–µ –≤ —Ç–µ—Ö –¥–µ—Ç–∞–ª—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫—Ç–æ –Ω–µ –≤–∏–¥–µ–ª."
                ]
            },
            {
                t: "Elon Musk",
                a: "Walter Isaacson",
                i: "https://is1-ssl.mzstatic.com/image/thumb/Publication126/v4/d4/c7/84/d4c78414-6599-e723-71de-837a0197dbd9/9781982181307.jpg/600x630w.png",
                pages: [
                    "–ò–ª–æ–Ω –ú–∞—Å–∫ –º–µ—á—Ç–∞–µ—Ç –æ –ú–∞—Ä—Å–µ. –ï–≥–æ –∫–æ–º–ø–∞–Ω–∏—è SpaceX –ø–µ—Ä–≤–æ–π —Å–æ–∑–¥–∞–ª–∞ –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–µ —Ä–∞–∫–µ—Ç—ã.",
                    "Tesla –ø–µ—Ä–µ–≤–µ—Ä–Ω—É–ª–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫, –¥–æ–∫–∞–∑–∞–≤, —á—Ç–æ —ç–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∫—Ä—É—Ç—ã–º–∏.",
                    "–ú–∞—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ 100 —á–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é –∏ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ —Ä–∏—Å–∫ ‚Äî —ç—Ç–æ –ø—É—Ç—å –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å—É."
                ]
            },
            {
                t: "Atomic Habits",
                a: "James Clear",
                i: "https://is1-ssl.mzstatic.com/image/thumb/Publication221/v4/1f/1b/d3/1f1bd34a-aa29-25e8-b133-7e19b38a5702/9780735211308.d.jpg/600x630w.png",
                pages: [
                    "–ü—Ä–∏–≤—ã—á–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –Ω–∞—à—É –ª–∏—á–Ω–æ—Å—Ç—å. –ú–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ–¥—É—Ç –∫ –±–æ–ª—å—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º.",
                    "1% –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–µ–ª–∞–µ—Ç –≤–∞—Å –≤ 37 —Ä–∞–∑ –ª—É—á—à–µ —á–µ—Ä–µ–∑ –≥–æ–¥.",
                    "–°–∏—Å—Ç–µ–º–∞ –≤–∞–∂–Ω–µ–µ —Ü–µ–ª–µ–π. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É—Å–ø–µ—Ö–∞, —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö."
                ]
            }
        ];

        const themes = [
            { id: 'beige', n: 'Beige', bg: '#FFF0DB', card: '#FFFFFF', text: '#000000', textCard: '#000000', acc: '#D9B99B' },
            { id: 'dark', n: 'Dark', bg: '#1d1f2f', card: '#252a3d', text: '#FFFFFF', textCard: '#FFFFFF', acc: '#0078D4' },
            { id: 'navy', n: 'Navy', bg: '#1a2744', card: '#243b55', text: '#FFFFFF', textCard: '#FFFFFF', acc: '#60a5fa' },
            { id: 'slate', n: 'Slate', bg: '#334155', card: '#475569', text: '#FFFFFF', textCard: '#FFFFFF', acc: '#94a3b8' },
            { id: 'steel', n: 'Steel Blue', bg: '#1e3a5f', card: '#2c5282', text: '#FFFFFF', textCard: '#FFFFFF', acc: '#0078D4' },
            { id: 'orange', n: 'Amber', bg: '#431407', card: '#7c2d12', text: '#FFFFFF', textCard: '#FFFFFF', acc: '#f59e0b' },
            { id: 'black', n: 'Black', bg: '#1A1A1A', card: '#333333', text: '#FFFFFF', textCard: '#FFFFFF', acc: '#FFFFFF' }
        ];

        let allBooks = [];
        let currentBookIdx = 0;
        let currentPageIdx = 0;
        let isAnimating = false;
        let heroClickHandler = null;
        const ADMIN_PASSWORD = "admin123";

        // ===== STORAGE (localStorage - works on GitHub Pages) =====
        async function loadFromStorage(key) {
            try {
                const result = localStorage.getItem('lum_' + key);
                const parsed = result ? JSON.parse(result) : null;
                console.log('[LOAD]', key, '->', parsed);
                return parsed;
            } catch (error) {
                console.error('[LOAD ERROR]', key, error);
                return null;
            }
        }

        async function saveToStorage(key, data) {
            try {
                localStorage.setItem('lum_' + key, JSON.stringify(data));
                console.log('[SAVE]', key, '->', data);
                return true;
            } catch (error) {
                console.error('[SAVE ERROR]', key, error);
                return false;
            }
        }

        // ===== NAVIGATION =====
        function switchTab(tab) {
            console.log('Switching to tab:', tab);
            
            // Reset education view to main ALWAYS when switching tabs
            document.querySelectorAll('.edu-section').forEach(x => x.classList.remove('active'));
            document.getElementById('edu-main').classList.add('active');
            
            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            
            // Show selected view
            document.getElementById(tab + '-view').classList.add('active');
            
            // Update nav buttons
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById('n-' + tab.charAt(0)).classList.add('active');
        }

        function goHome() {
            switchTab('home');
        }

        function openEduLevel(id) {
            document.querySelectorAll('.edu-section').forEach(x => x.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // ===== ADMIN =====
        function openAdminPanel() {
            document.getElementById('admin-modal').classList.add('active');
        }

        function closeAdminPanel() {
            document.getElementById('admin-modal').classList.remove('active');
        }

        function checkPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('password-section').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadAdminData();
            } else {
                alert('Incorrect password!');
            }
        }

        async function loadAdminData() {
            const customBooks = await loadFromStorage('custom-books') || [];
            displayAdminBooks(customBooks);

            const satWords = await loadFromStorage('sat-words') || [];
            displayAdminWords('sat-word-list', satWords, 'sat');

            const ieltsWords = await loadFromStorage('ielts-words') || [];
            displayAdminWords('ielts-word-list', ieltsWords, 'ielts');

            const podcasts = await loadFromStorage('podcasts') || [];
            displayAdminPodcasts(podcasts);
        }

        function displayAdminBooks(books) {
            const container = document.getElementById('book-list-admin');
            if (books.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No custom books yet</p>';
                return;
            }
            
            container.innerHTML = books.map((book, idx) => `
                <div class="book-admin-entry">
                    <div class="book-admin-thumb" style="background-image:url('${book.i}')"></div>
                    <div class="item-info">
                        <div class="item-title">${book.t}</div>
                        <div class="item-detail">by ${book.a} ‚Ä¢ ${book.pages.length} pages</div>
                    </div>
                    <button class="btn-delete" onclick="deleteBook(${idx})">Delete</button>
                </div>
            `).join('');
        }

        function displayAdminWords(containerId, words, type) {
            const container = document.getElementById(containerId);
            if (words.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No words yet</p>';
                return;
            }
            
            container.innerHTML = words.map((word, idx) => `
                <div class="item-entry">
                    <div class="item-info">
                        <div class="item-title">${word.w}</div>
                        <div class="item-detail">${word.d}</div>
                    </div>
                    <button class="btn-delete" onclick="deleteWord('${type}', ${idx})">Delete</button>
                </div>
            `).join('');
        }

        function displayAdminPodcasts(podcasts) {
            const container = document.getElementById('podcast-list-admin');
            if (podcasts.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No podcasts yet</p>';
                return;
            }
            
            container.innerHTML = podcasts.map((podcast, idx) => `
                <div class="item-entry">
                    <div class="item-info">
                        <div class="item-title">${podcast.t}</div>
                        <div class="item-detail">${podcast.u}</div>
                    </div>
                    <button class="btn-delete" onclick="deletePodcast(${idx})">Delete</button>
                </div>
            `).join('');
        }

        // Step 1: Admin enters book info + number of chapters ‚Üí generate chapter forms
        function setupChapters() {
            const title = document.getElementById('book-title').value.trim();
            const author = document.getElementById('book-author').value.trim();
            const cover = document.getElementById('book-cover').value.trim();
            const numChapters = parseInt(document.getElementById('book-chapters').value);

            if (!title || !author || !cover || !numChapters || numChapters < 1) {
                alert('Please fill in all fields and enter a valid number of chapters');
                return;
            }

            const builder = document.getElementById('chapters-builder');
            builder.innerHTML = '';

            for (let c = 1; c <= numChapters; c++) {
                builder.innerHTML += `
                    <div style="background:white;border-radius:15px;padding:20px;margin-bottom:15px;">
                        <div style="font-weight:800;font-size:16px;margin-bottom:12px;">üìñ Chapter ${c}</div>
                        <div class="form-group">
                            <label>Chapter Title (optional)</label>
                            <input type="text" id="ch-title-${c}" placeholder="e.g., The Beginning">
                        </div>
                        <div class="form-group">
                            <label>Number of Pages in this Chapter</label>
                            <input type="number" id="ch-pages-${c}" min="1" max="200" placeholder="e.g., 3" onchange="setupPages(${c})">
                        </div>
                        <div id="ch-pages-area-${c}"></div>
                    </div>
                `;
            }

            document.getElementById('book-step-1').style.display = 'none';
            document.getElementById('book-step-2').style.display = 'block';
        }

        // Step 2: When admin sets page count for a chapter ‚Üí generate text areas
        function setupPages(chapterNum) {
            const numPages = parseInt(document.getElementById(`ch-pages-${chapterNum}`).value);
            if (!numPages || numPages < 1) return;

            const area = document.getElementById(`ch-pages-area-${chapterNum}`);
            area.innerHTML = '';

            for (let p = 1; p <= numPages; p++) {
                area.innerHTML += `
                    <div class="form-group">
                        <label>Page ${p} text</label>
                        <textarea id="ch-${chapterNum}-pg-${p}" placeholder="Type the text for page ${p}..." style="min-height:100px;width:100%;padding:12px;border:2px solid rgba(0,0,0,0.1);border-radius:12px;font-family:inherit;font-size:14px;resize:vertical;"></textarea>
                    </div>
                `;
            }
        }

        // Step 3: Collect all data and save
        async function addBook() {
            const title = document.getElementById('book-title').value.trim();
            const author = document.getElementById('book-author').value.trim();
            const cover = document.getElementById('book-cover').value.trim();
            const numChapters = parseInt(document.getElementById('book-chapters').value);

            if (!title || !author || !cover || !numChapters) {
                alert('Missing book info');
                return;
            }

            const pages = []; // flat list of pages for the reader

            for (let c = 1; c <= numChapters; c++) {
                const chTitle = document.getElementById(`ch-title-${c}`)?.value.trim();
                const numPages = parseInt(document.getElementById(`ch-pages-${c}`)?.value);

                if (!numPages || numPages < 1) {
                    alert(`Please set the number of pages for Chapter ${c}`);
                    return;
                }

                for (let p = 1; p <= numPages; p++) {
                    const pageText = document.getElementById(`ch-${c}-pg-${p}`)?.value.trim();
                    if (!pageText) {
                        alert(`Chapter ${c}, Page ${p} is empty!`);
                        return;
                    }
                    // Prepend chapter title on first page of each chapter
                    const prefix = (p === 1 && chTitle) ? `${chTitle}\n\n` : '';
                    pages.push(prefix + pageText);
                }
            }

            if (pages.length === 0) {
                alert('No pages found!');
                return;
            }

            const customBooks = await loadFromStorage('custom-books') || [];
            customBooks.push({ t: title, a: author, i: cover, pages });
            await saveToStorage('custom-books', customBooks);

            showSuccess(`"${title}" added with ${pages.length} pages!`);
            resetBookForm();
            loadAdminData();
            await loadAllBooks();
            renderBooks(allBooks);
        }

        function resetBookForm() {
            document.getElementById('book-title').value = '';
            document.getElementById('book-author').value = '';
            document.getElementById('book-cover').value = '';
            document.getElementById('book-chapters').value = '';
            document.getElementById('chapters-builder').innerHTML = '';
            document.getElementById('book-step-1').style.display = 'block';
            document.getElementById('book-step-2').style.display = 'none';
        }

        async function addSATWord() {
            const word = document.getElementById('sat-word').value.trim();
            const def = document.getElementById('sat-def').value.trim();
            
            if (!word || !def) {
                alert('Please fill in all fields');
                return;
            }

            const satWords = await loadFromStorage('sat-words') || [];
            satWords.push({ w: word, d: def });
            await saveToStorage('sat-words', satWords);

            document.getElementById('sat-word').value = '';
            document.getElementById('sat-def').value = '';
            
            showSuccess('SAT word added!');
            loadAdminData();
            await renderVocabLists();
        }

        async function addIELTSWord() {
            const word = document.getElementById('ielts-word').value.trim();
            const def = document.getElementById('ielts-def').value.trim();
            
            if (!word || !def) {
                alert('Please fill in all fields');
                return;
            }

            const ieltsWords = await loadFromStorage('ielts-words') || [];
            ieltsWords.push({ w: word, d: def });
            await saveToStorage('ielts-words', ieltsWords);

            document.getElementById('ielts-word').value = '';
            document.getElementById('ielts-def').value = '';
            
            showSuccess('IELTS word added!');
            loadAdminData();
            await renderVocabLists();
        }

        async function addPodcast() {
            const title = document.getElementById('podcast-title').value.trim();
            const url = document.getElementById('podcast-url').value.trim();
            
            if (!title || !url) {
                alert('Please fill in all fields');
                return;
            }

            let videoId = '';
            if (url.includes('youtu.be/')) {
                videoId = url.split('youtu.be/')[1].split('?')[0];
            } else if (url.includes('youtube.com/watch?v=')) {
                videoId = url.split('v=')[1].split('&')[0];
            }

            const podcasts = await loadFromStorage('podcasts') || [];
            podcasts.push({
                t: title,
                u: url,
                i: `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`
            });
            await saveToStorage('podcasts', podcasts);

            document.getElementById('podcast-title').value = '';
            document.getElementById('podcast-url').value = '';
            
            showSuccess('Podcast added!');
            loadAdminData();
            await renderPodcasts();
        }

        async function deleteBook(idx) {
            if (!confirm('Delete this book?')) return;
            const customBooks = await loadFromStorage('custom-books') || [];
            customBooks.splice(idx, 1);
            await saveToStorage('custom-books', customBooks);
            loadAdminData();
            await loadAllBooks();
            renderBooks(allBooks);
        }

        async function deleteWord(type, idx) {
            if (!confirm('Delete this word?')) return;
            const key = type === 'sat' ? 'sat-words' : 'ielts-words';
            const words = await loadFromStorage(key) || [];
            words.splice(idx, 1);
            await saveToStorage(key, words);
            loadAdminData();
            await renderVocabLists();
        }

        async function deletePodcast(idx) {
            if (!confirm('Delete this podcast?')) return;
            const podcasts = await loadFromStorage('podcasts') || [];
            podcasts.splice(idx, 1);
            await saveToStorage('podcasts', podcasts);
            loadAdminData();
            await renderPodcasts();
        }

        function showSuccess(message) {
            const existing = document.querySelector('.success-message');
            if (existing) existing.remove();

            const msg = document.createElement('div');
            msg.className = 'success-message';
            msg.textContent = message;
            document.querySelector('.modal-content').insertBefore(msg, document.querySelector('.modal-content').firstChild.nextSibling);
            
            setTimeout(() => msg.remove(), 3000);
        }

        // ===== LOAD & RENDER =====
        async function loadAllBooks() {
            const customBooks = await loadFromStorage('custom-books') || [];
            allBooks = [...defaultBooks, ...customBooks];
        }

        async function renderVocabLists() {
            const satWords = await loadFromStorage('sat-words') || [];
            const satContainer = document.getElementById('vocab-list-sat');
            if (satWords.length === 0) {
                satContainer.innerHTML = '<div class="sub-card">No SAT words yet</div>';
            } else {
                satContainer.innerHTML = satWords.map(w => `
                    <div class="vocab-item">
                        <div class="v-word">${w.w}</div>
                        <div class="v-def">${w.d}</div>
                    </div>
                `).join('');
            }

            const ieltsWords = await loadFromStorage('ielts-words') || [];
            const ieltsContainer = document.getElementById('vocab-list-ielts');
            if (ieltsWords.length === 0) {
                ieltsContainer.innerHTML = '<div class="sub-card">No IELTS words yet</div>';
            } else {
                ieltsContainer.innerHTML = ieltsWords.map(w => `
                    <div class="vocab-item">
                        <div class="v-word">${w.w}</div>
                        <div class="v-def">${w.d}</div>
                    </div>
                `).join('');
            }
        }

        async function renderPodcasts() {
            const podcasts = await loadFromStorage('podcasts') || [];
            const container = document.getElementById('podcast-container');
            
            if (podcasts.length === 0) {
                container.innerHTML = '<div class="sub-card">No podcasts yet</div>';
            } else {
                container.innerHTML = podcasts.map(p => `
                    <a href="${p.u}" target="_blank" class="podcast-item">
                        <div class="podcast-thumb" style="background-image:url('${p.i}')"></div>
                        <div class="podcast-body">
                            <h3>${p.t}</h3>
                            <span>–°–ª—É—à–∞—Ç—å –Ω–∞ YouTube</span>
                        </div>
                    </a>
                `).join('');
            }
        }

        // ===== BOOKS =====
        function openBook(idx) {
            currentBookIdx = idx;
            currentPageIdx = 0;
            document.getElementById('reader-book-title').innerText = allBooks[idx].t;
            document.getElementById('reader-view').style.display = 'flex';
            renderPage();
        }

        function closeBook() {
            document.getElementById('reader-view').style.display = 'none';
        }

        function animatePageChange(dir) {
            if (isAnimating) return;
            let book = allBooks[currentBookIdx];
            let newPage = currentPageIdx + dir;

            if (newPage < 0) {
                alert("–≠—Ç–æ –Ω–∞—á–∞–ª–æ –∫–Ω–∏–≥–∏");
                return;
            }
            if (newPage >= book.pages.length) {
                alert("–ö–Ω–∏–≥–∞ –æ–∫–æ–Ω—á–µ–Ω–∞");
                return;
            }

            isAnimating = true;
            const content = document.getElementById('page-content');

            content.classList.remove('page-active');
            content.classList.add(dir > 0 ? 'page-enter-left' : 'page-enter-right');

            setTimeout(() => {
                currentPageIdx = newPage;
                renderPage();
                content.classList.remove('page-enter-left', 'page-enter-right');
                content.classList.add(dir > 0 ? 'page-enter-right' : 'page-enter-left');

                setTimeout(() => {
                    content.classList.add('page-active');
                    content.classList.remove('page-enter-right', 'page-enter-left');
                    isAnimating = false;
                }, 50);
            }, 400);
        }

        function renderPage() {
            document.getElementById('page-content').innerText = allBooks[currentBookIdx].pages[currentPageIdx];
        }

        function renderBooks(arr) {
            document.getElementById('book-grid').innerHTML = arr.map((b, i) => `
                <div class="book-card" style="background-image:url('${b.i}')" onclick="openBook(${i})"></div>
            `).join('');
        }

        function handleSearch(e) {
            const q = e.target.value.toLowerCase();
            renderBooks(allBooks.filter(b => b.t.toLowerCase().includes(q)));
        }

        function updateHeroBanner(idx) {
            const heroBanner = document.getElementById('hero-banner');
            heroBanner.style.backgroundImage = `url('${allBooks[idx].i}')`;
            document.getElementById('hero-title').innerText = allBooks[idx].t;
            
            if (heroClickHandler) {
                heroBanner.removeEventListener('click', heroClickHandler);
            }
            
            heroClickHandler = function() { openBook(idx); };
            heroBanner.addEventListener('click', heroClickHandler);
        }

        // ===== THEMES =====
        function setTheme(id) {
            const t = themes.find(x => x.id === id);
            document.documentElement.style.setProperty('--bg-page', t.bg);
            document.documentElement.style.setProperty('--bg-card', t.card);
            document.documentElement.style.setProperty('--text-main', t.text);
            document.documentElement.style.setProperty('--text-on-card', t.textCard);
            document.documentElement.style.setProperty('--accent', t.acc);
            localStorage.setItem('lum_theme', id);
            renderThemeGrid();
        }

        function renderThemeGrid() {
            const curr = localStorage.getItem('lum_theme') || 'beige';
            document.getElementById('theme-grid').innerHTML = themes.map(t => `
                <div class="theme-btn ${t.id === curr ? 'active' : ''}" onclick="setTheme('${t.id}')">
                    <div class="color-dot" style="background:${t.bg}"></div> ${t.n}
                </div>
            `).join('');
        }

        function saveNotes() {
            localStorage.setItem('lum_notes', document.getElementById('notes-area').value);
        }

        // ===== INIT =====
        async function init() {
            await loadAllBooks();
            renderBooks(allBooks);
            await renderVocabLists();
            await renderPodcasts();
            renderThemeGrid();
            
            document.getElementById('notes-area').value = localStorage.getItem('lum_notes') || "";
            setTheme(localStorage.getItem('lum_theme') || 'beige');
            updateHeroBanner(0);

            let hIdx = 0;
            setInterval(() => {
                hIdx = (hIdx + 1) % allBooks.length;
                updateHeroBanner(hIdx);
            }, 5000);
        }

        init();
    </script>
</body>
</html>
